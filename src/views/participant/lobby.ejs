<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SID2026 - Lobby</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <h1>Welcome, <%= user.name %></h1>
        
        <% if (user.role === 'facilitator') { %>
            <div style="margin-bottom: 20px; border: 2px solid black; padding: 10px;">
                <p>>> ADMIN_ACCESS_GRANTED</p>
                <a href="/admin"><button style="width: 100%; margin: 0;">>> ACCESS_DASHBOARD</button></a>
            </div>
        <% } %>

        <p>Waiting for the event to start...</p>
        <div id="status">Status: Handshake established. Standby.</div>
    </div>
    <script src="/js/firebase.js"></script>
    <script type="module">
        import { db, doc, onSnapshot } from "/js/db.js";
        
        const sessionId = "default-session";
        const statusDiv = document.getElementById("status");

        console.log(">> LISTENING_FOR_SESSION_UPDATES (MODULAR)");

        onSnapshot(doc(db, "sessions", sessionId), (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                const activity = data.currentActivity;
                
                if (activity && activity !== "none") {
                    console.log(">> ACTIVITY_DETECTED: " + activity);
                    statusDiv.innerText = "REDIRECTING_TO_MODULE: " + activity.toUpperCase();
                    setTimeout(() => {
                        window.location.href = "/activity/" + activity;
                    }, 1000);
                } else {
                    statusDiv.innerText = "Status: AWAITING_COMMAND";
                }
            } else {
                console.log(">> SESSION_NOT_FOUND");
            }
        });
    </script>
</body>
</html>
