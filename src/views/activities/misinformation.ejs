<div id="misinformation-container">
    <h2>>> CONTENT_VERIFICATION</h2>
    <p>REVIEW_HEADLINE_ON_SCREEN.</p>
    
    <div id="step-1">
        <h3>WOULD_YOU_SHARE_THIS?</h3>
        <div class="options-grid">
            <button class="cyber-button" onclick="setShare(true)">>> YES_SHARE</button>
            <button class="cyber-button" onclick="setShare(false)">>> NO_IGNORE</button>
        </div>
    </div>

    <div id="step-2" style="display:none;">
        <h3>REASONING_REQUIRED:</h3>
        <div class="red-flags-list">
            <label class="cyber-checkbox">
                <input type="checkbox" value="looks_official"> LOOKS_OFFICIAL
            </label>
            <label class="cyber-checkbox">
                <input type="checkbox" value="credible_source"> CREDIBLE_SOURCE
            </label>
            <label class="cyber-checkbox">
                <input type="checkbox" value="urgent_alarming"> URGENT_OR_ALARMING
            </label>
            <label class="cyber-checkbox">
                <input type="checkbox" value="recognised_format"> RECOGNIZED_FORMAT
            </label>
            <label class="cyber-checkbox">
                <input type="checkbox" value="would_verify"> WOULD_VERIFY_FIRST
            </label>
            <label class="cyber-checkbox">
                <input type="checkbox" value="never_share"> NEVER_SHARE_WITHOUT_CHECK
            </label>
        </div>
        <button id="final-submit" class="cyber-button action-btn" onclick="submitMisinfo()">>> CONFIRM_ANALYSIS</button>
    </div>

    <div id="misinfo-status" style="margin-top:20px; display:none;">
        DATA_LOGGED. STANDBY_FOR_DEBRIEF.
    </div>
</div>

<script>
    let shareChoice = null;

    function setShare(choice) {
        shareChoice = choice;
        document.getElementById('step-1').style.display = 'none';
        document.getElementById('step-2').style.display = 'block';
    }

    async function submitMisinfo() {
        const reasons = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
        
        try {
            const response = await fetch('/activity/misinformation/respond', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ share: shareChoice, reasons: reasons })
            });
            
            if (response.ok) {
                document.getElementById('step-2').style.display = 'none';
                document.getElementById('misinfo-status').style.display = 'block';
            }
        } catch (e) {
            console.error(e);
            alert("TRANSMISSION_ERROR");
        }
    }
</script>
